local RainbowUI = loadstring(game:HttpGet("https://raw.githubusercontent.com/luis32405516-cmyk/library.lua/refs/heads/main/Prueba2"))()
local hud = RainbowUI:CreateWindow(230, 450)

local Players = game:GetService("Players")
local LP = Players.LocalPlayer
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

-- [[ VARIABLES CORE DE IY ]]
local FLYING = false
local iyflyspeed = 1
local vehicleflyspeed = 1
local mfly1, mfly2 = nil, nil
local velocityHandlerName = "IY_Velocity"
local gyroHandlerName = "IY_Gyro"

-- Funci√≥n necesaria para obtener el RootPart (Original de IY)
local function getRoot(char)
	return char:FindFirstChild('HumanoidRootPart') or char:FindFirstChild('Torso') or char:FindFirstChild('UpperTorso')
end

-- [[ L√ìGICA DE UNMOBILEFLY (Limpiar) ]]
local function unmobilefly()
    pcall(function()
        FLYING = false
        if mfly1 then mfly1:Disconnect() end
        if mfly2 then mfly2:Disconnect() end
        local char = LP.Character
        local root = getRoot(char)
        if root:FindFirstChild(velocityHandlerName) then root[velocityHandlerName]:Destroy() end
        if root:FindFirstChild(gyroHandlerName) then root[gyroHandlerName]:Destroy() end
        if char:FindFirstChildWhichIsA("Humanoid") then
            char:FindFirstChildWhichIsA("Humanoid").PlatformStand = false
        end
    end)
end

-- [[ L√ìGICA DE MOBILEFLY (El que funciona en Android) ]]
local function mobilefly(vfly)
    unmobilefly()
    FLYING = true
    local char = LP.Character
    local root = getRoot(char)
    local camera = workspace.CurrentCamera
    
    -- Cargar el modulo de controles de Roblox para leer el Joystick
    local controlModule = require(LP.PlayerScripts:WaitForChild("PlayerModule"):WaitForChild("ControlModule"))
    
    local bv = Instance.new("BodyVelocity")
    bv.Name = velocityHandlerName
    bv.Parent = root
    bv.MaxForce = Vector3.new(9e9, 9e9, 9e9)
    bv.Velocity = Vector3.new(0, 0, 0)

    local bg = Instance.new("BodyGyro")
    bg.Name = gyroHandlerName
    bg.Parent = root
    bg.MaxTorque = Vector3.new(9e9, 9e9, 9e9)
    bg.P = 1000
    bg.D = 50

    mfly2 = RunService.RenderStepped:Connect(function()
        if FLYING and char and char.Parent then
            local humanoid = char:FindFirstChildWhichIsA("Humanoid")
            local VelocityHandler = root:FindFirstChild(velocityHandlerName)
            local GyroHandler = root:FindFirstChild(gyroHandlerName)

            if humanoid and VelocityHandler and GyroHandler then
                humanoid.PlatformStand = true
                GyroHandler.CFrame = camera.CFrame
                
                local direction = controlModule:GetMoveVector()
                local flyVelocity = Vector3.new(0,0,0)
                
                -- C√°lculo de direcci√≥n seg√∫n el Joystick y la C√°mara
                if direction.X ~= 0 then
                    flyVelocity = flyVelocity + camera.CFrame.RightVector * (direction.X * (iyflyspeed * 50))
                end
                if direction.Z ~= 0 then
                    flyVelocity = flyVelocity - camera.CFrame.LookVector * (direction.Z * (iyflyspeed * 50))
                end
                
                VelocityHandler.Velocity = flyVelocity
            end
        end
    end)
end

-- [[ INTEGRACI√ìN EN TU LIBRER√çA ]]
local fMov = hud:AddFolder("MOVIMIENTO ‚ö°")

fMov:AddButton("FLY MOBILE (IY) ‚úàÔ∏è", function()
    if FLYING then
        unmobilefly()
        hud:Notify("Fly Desactivado", 2)
    else
        mobilefly(false)
        hud:Notify("Fly Activado (Usa el Joystick)", 2)
    end
end)

fMov:AddSlider("Fly Speed", 1, 10, 1, function(v)
    iyflyspeed = v
end)

fMov:AddSlider("WalkSpeed", 16, 300, 16, function(v)
    if LP.Character and LP.Character:FindFirstChildOfClass("Humanoid") then
        LP.Character:FindFirstChildOfClass("Humanoid").WalkSpeed = v
    end
end)

-- Bot√≥n de Noclip (Indispensable para volar mejor)
local noclipActive = false
fMov:AddButton("NOCLIP üëª", function()
    noclipActive = not noclipActive
    if noclipActive then
        _G.Noclipping = RunService.Stepped:Connect(function()
            if LP.Character then
                for _, v in pairs(LP.Character:GetDescendants()) do
                    if v:IsA("BasePart") then v.CanCollide = false end
                end
            end
        end)
    else
        if _G.Noclipping then _G.Noclipping:Disconnect() end
    end
    hud:Notify("Noclip: " .. tostring(noclipActive))
end)

hud:Notify("FLY IY ANDROID CARGADO üòà")
