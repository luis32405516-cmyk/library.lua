-- [[ LUIS UNV - FINAL FIX: AUTO-OPEN + CUSTOM LABELS ]]

local LP = game:GetService("Players").LocalPlayer
local HttpService = game:GetService("HttpService")
local fRequest = request or http_request or syn_request or (fluxus and fluxus.request)
local fOpenUrl = openurl or (api_open_url)

local service = 18296
local FILE_PATH = "LuisUNV_Key.txt" 
local SCRIPT_URL = "https://raw.githubusercontent.com/luis32405516-cmyk/library.lua/refs/heads/main/Ray1"

-- Función de Verificación
local function verify(key)
    if not key or key == "" then return false end
    local url = "https://api.platoboost.net/public/whitelist/"..service.."?identifier="..LP.UserId.."&key="..key
    local success, response = pcall(function() 
        return fRequest({Url = url, Method = "GET"}) 
    end)
    if success and response.StatusCode == 200 then
        local decoded = HttpService:JSONDecode(response.Body)
        return decoded.success and decoded.data.valid
    end
    return false
end

-- [[ AUTO-LOADER (WORKSPACE) ]]
if isfile(FILE_PATH) then
    local savedKey = readfile(FILE_PATH)
    if verify(savedKey) then
        loadstring(game:HttpGet(SCRIPT_URL))()
        return
    end
end

-- [[ INTERFAZ MOVIBLE ]]
local ScreenGui = Instance.new("ScreenGui", game:GetService("CoreGui"))
local Main = Instance.new("Frame", ScreenGui)
Main.Size = UDim2.new(0, 320, 0, 210)
Main.Position = UDim2.new(0.5, -160, 0.5, -105)
Main.BackgroundColor3 = Color3.fromRGB(12, 12, 12)
Main.Active = true
Main.Draggable = true 
Instance.new("UICorner", Main).CornerRadius = UDim.new(0, 10)

-- Borde Neón
local UIStroke = Instance.new("UIStroke", Main)
UIStroke.Thickness = 2
task.spawn(function()
    while task.wait(0.01) do
        UIStroke.Color = Color3.fromHSV(tick() % 5 / 5, 0.8, 1)
    end
end)

-- Botón Cerrar
local CloseBtn = Instance.new("TextButton", Main)
CloseBtn.Text = "X"; CloseBtn.Size = UDim2.new(0, 30, 0, 30); CloseBtn.Position = UDim2.new(1, -35, 0, 5)
CloseBtn.BackgroundColor3 = Color3.fromRGB(180, 0, 0); CloseBtn.TextColor3 = Color3.new(1, 1, 1)
Instance.new("UICorner", CloseBtn)
CloseBtn.MouseButton1Click:Connect(function() ScreenGui:Destroy() end)

local Title = Instance.new("TextLabel", Main)
Title.Text = "LUIS UNV SYSTEM"; Title.Size = UDim2.new(1, 0, 0, 50)
Title.TextColor3 = Color3.new(1,1,1); Title.BackgroundTransparency = 1; Title.Font = Enum.Font.GothamBold

-- Nombre cambiado a "KEY" como pediste
local Input = Instance.new("TextBox", Main)
Input.PlaceholderText = "KEY"; Input.Text = "" 
Input.Size = UDim2.new(0.85, 0, 0, 40); Input.Position = UDim2.new(0.075, 0, 0.3, 0)
Input.BackgroundColor3 = Color3.fromRGB(22, 22, 22); Input.TextColor3 = Color3.new(1, 1, 1)
Instance.new("UICorner", Input)

-- Nombre mantenido como "OBTENER KEY"
local GetBtn = Instance.new("TextButton", Main)
GetBtn.Text = "OBTENER KEY"; GetBtn.Size = UDim2.new(0.4, 0, 0, 35)
GetBtn.Position = UDim2.new(0.075, 0, 0.55, 0); GetBtn.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
GetBtn.TextColor3 = Color3.new(1, 1, 1); Instance.new("UICorner", GetBtn)

local VerifyBtn = Instance.new("TextButton", Main)
VerifyBtn.Text = "VERIFICAR"; VerifyBtn.Size = UDim2.new(0.4, 0, 0, 35)
VerifyBtn.Position = UDim2.new(0.525, 0, 0.55, 0); VerifyBtn.BackgroundColor3 = Color3.fromRGB(0, 150, 100)
VerifyBtn.TextColor3 = Color3.new(1, 1, 1); Instance.new("UICorner", VerifyBtn)

-- Lógica para ABRIR NAVEGADOR directamente
GetBtn.MouseButton1Click:Connect(function()
    local res = fRequest({
        Url = "https://api.platoboost.net/public/start",
        Method = "POST",
        Headers = {["Content-Type"] = "application/json"},
        Body = HttpService:JSONEncode({service = service, identifier = tostring(LP.UserId)})
    })
    if res.StatusCode == 200 then
        local url = HttpService:JSONDecode(res.Body).data.url
        setclipboard(url) -- Backup
        -- Intento forzado de apertura
        if fOpenUrl then
            fOpenUrl(url)
        else
            -- Si el ejecutor no tiene openurl, esto suele forzarlo en Android
            game:GetService("GuiService"):OpenBrowserWindow(url)
        end
    end
end)

VerifyBtn.MouseButton1Click:Connect(function()
    if verify(Input.Text) then
        writefile(FILE_PATH, Input.Text)
        ScreenGui:Destroy()
        loadstring(game:HttpGet(SCRIPT_URL))()
    end
end)
