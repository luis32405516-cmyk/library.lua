-- [[ LUIS UNV - AUTO-SAVE KEY SYSTEM (ESTILO DELTA) ]]

local LP = game:GetService("Players").LocalPlayer
local HttpService = game:GetService("HttpService")
local fRequest = request or http_request or syn_request or (fluxus and fluxus.request)

-- CONFIGURACIÓN
local service = 18296
local SCRIPT_GITHUB = "https://raw.githubusercontent.com/luis32405516-cmyk/library.lua/refs/heads/main/Ray1"
local FILE_NAME = "LuisUNV_Key.txt" -- Nombre del archivo que se guardará en tu ejecutor

-- [[ FUNCIONES DE ARCHIVO (AUTO-SAVE) ]]
local function saveKey(key)
    if writefile then
        writefile(FILE_NAME, key)
    end
end

local function readSavedKey()
    if isfile and isfile(FILE_NAME) then
        return readfile(FILE_NAME)
    end
    return nil
end

-- [[ FUNCIONES DE API ]]
local function getLink()
    local url = "https://api.platoboost.net/public/start"
    local success, response = pcall(function()
        return fRequest({
            Url = url,
            Method = "POST",
            Headers = {["Content-Type"] = "application/json"},
            Body = HttpService:JSONEncode({
                service = service,
                identifier = tostring(LP.UserId)
            })
        })
    end)
    if success and response.StatusCode == 200 then
        local decoded = HttpService:JSONDecode(response.Body)
        if decoded.success then
            setclipboard(decoded.data.url)
            return true
        end
    end
    return false
end

local function verify(key)
    if not key or key == "" then return false end
    local url = "https://api.platoboost.net/public/whitelist/"..service.."?identifier="..LP.UserId.."&key="..key
    local success, response = pcall(function()
        return fRequest({Url = url, Method = "GET"})
    end)
    if success and response.StatusCode == 200 then
        local decoded = HttpService:JSONDecode(response.Body)
        return decoded.success and decoded.data.valid
    end
    return false
end

-- [[ LÓGICA DE AUTO-CARGA ]]
local savedKey = readSavedKey()
if savedKey and verify(savedKey) then
    -- Si la llave guardada funciona, cargamos el script directo
    loadstring(game:HttpGet(SCRIPT_GITHUB))()
    return -- Detenemos el resto del script para que no salga la interfaz
end

-- [[ INTERFAZ (Solo sale si no hay llave válida guardada) ]]
local ScreenGui = Instance.new("ScreenGui", game:GetService("CoreGui"))
local Main = Instance.new("Frame", ScreenGui)
Main.Size = UDim2.new(0, 300, 0, 190); Main.Position = UDim2.new(0.5, -150, 0.5, -95); Main.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
Instance.new("UICorner", Main)

local Title = Instance.new("TextLabel", Main)
Title.Text = "LUIS UNV | KEY SYSTEM"; Title.Size = UDim2.new(1, 0, 0, 40); Title.TextColor3 = Color3.new(1,1,1); Title.BackgroundTransparency = 1

local Input = Instance.new("TextBox", Main)
Input.PlaceholderText = "Pega tu Key aquí..."; Input.Size = UDim2.new(0.8, 0, 0, 35); Input.Position = UDim2.new(0.1, 0, 0.25, 0); Input.BackgroundColor3 = Color3.fromRGB(30, 30, 30); Input.TextColor3 = Color3.new(1, 1, 1); Instance.new("UICorner", Input)

local GetBtn = Instance.new("TextButton", Main)
GetBtn.Text = "OBTENER KEY"; GetBtn.Size = UDim2.new(0.8, 0, 0, 35); GetBtn.Position = UDim2.new(0.1, 0, 0.5, 0); GetBtn.BackgroundColor3 = Color3.fromRGB(50, 50, 50); GetBtn.TextColor3 = Color3.new(1, 1, 1); Instance.new("UICorner", GetBtn)

GetBtn.MouseButton1Click:Connect(function()
    if getLink() then GetBtn.Text = "¡COPIADO!" else GetBtn.Text = "ERROR DE RED" end
    task.wait(2); GetBtn.Text = "OBTENER KEY"
end)

local VerifyBtn = Instance.new("TextButton", Main)
VerifyBtn.Text = "VERIFICAR"; VerifyBtn.Size = UDim2.new(0.8, 0, 0, 35); VerifyBtn.Position = UDim2.new(0.1, 0, 0.75, 0); VerifyBtn.BackgroundColor3 = Color3.fromRGB(0, 150, 100); VerifyBtn.TextColor3 = Color3.new(1, 1, 1); Instance.new("UICorner", VerifyBtn)

VerifyBtn.MouseButton1Click:Connect(function()
    local key = Input.Text
    if verify(key) then
        saveKey(key) -- Guardamos la llave para la próxima vez
        ScreenGui:Destroy()
        loadstring(game:HttpGet(SCRIPT_GITHUB))()
    else
        VerifyBtn.Text = "KEY INVÁLIDA"; task.wait(2); VerifyBtn.Text = "VERIFICAR"
    end
end)
