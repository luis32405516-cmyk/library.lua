local RainbowUI = loadstring(game:HttpGet("https://raw.githubusercontent.com/luis32405516-cmyk/library.lua/refs/heads/main/Prueba2?v=" .. tick()))()
local hud = RainbowUI:CreateWindow(240, 520)

local player = game.Players.LocalPlayer
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

local state = { 
    fly = false, 
    flySpeed = 70, 
    noclip = false,
    currentVel = Vector3.zero,
    easing = 10
}

local bv, bg, flyConn

local fMov = hud:AddFolder("AJUSTES PERSONAJE ‚öôÔ∏è")

-- L√ìGICA DE VUELO BASADA EN TU SCRIPT (FLEW V3)
local function flightStep(dt)
    local char = player.Character
    if not char or not state.fly then return end
    local root = char:FindFirstChild("HumanoidRootPart")
    local hum = char:FindFirstChildOfClass("Humanoid")
    local camera = workspace.CurrentCamera
    
    if not root or not bv or not bg then return end

    local dir = Vector3.zero
    local camCF = camera.CFrame

    -- 1. Capturar movimiento del Joystick (Mobile) o Teclado
    local moveVector = hum.MoveDirection
    
    -- 2. CALCULAR DIRECCI√ìN HACIA DONDE MIRA LA C√ÅMARA
    -- Si mueves el joystick hacia adelante (Z < 0 en MoveDirection interna), 
    -- usamos el LookVector de la c√°mara para que el mu√±eco suba o baje.
    if moveVector.Magnitude > 0 then
        -- Esta es la l√≥gica que faltaba para que "vuele" y no solo se deslice:
        dir = camCF:VectorToWorldSpace(Vector3.new(moveVector.X, 0, moveVector.Z))
        -- Si vas hacia adelante, el mu√±eco sigue la inclinaci√≥n de la c√°mara (arriba/abajo)
        dir = (camCF.LookVector * (moveVector.Z < 0 and -1 or moveVector.Z > 0 and 1 or 0) * -1) + 
              (camCF.RightVector * (moveVector.X > 0 and 1 or moveVector.X < 0 and -1 or 0))
    end

    -- Soporte para subir/bajar extra
    if UserInputService:IsKeyDown(Enum.KeyCode.Space) then dir += Vector3.yAxis end
    if UserInputService:IsKeyDown(Enum.KeyCode.LeftControl) then dir -= Vector3.yAxis end

    local total = dir
    if total.Magnitude > 0 then 
        total = total.Unit * state.flySpeed 
    end

    -- 3. Aplicar movimiento suave
    state.currentVel = state.currentVel:Lerp(total, math.clamp(state.easing * dt, 0, 1))
    bv.Velocity = state.currentVel
    
    -- 4. SEGUIR LA C√ÅMARA (El mu√±eco se voltea hacia donde miras)
    bg.CFrame = camCF
end

fMov:AddButton("VOLAR (FLY V3 CORREGIDO)", function()
    state.fly = not state.fly
    local char = player.Character
    local root = char and char:FindFirstChild("HumanoidRootPart")
    local hum = char and char:FindFirstChildOfClass("Humanoid")

    if state.fly and root and hum then
        hud:Notify("Fly: ACTIVADO üöÄ")
        
        -- Fuerzas con potencia alta para despegar del suelo
        bv = Instance.new("BodyVelocity", root)
        bv.MaxForce = Vector3.new(9e9, 9e9, 9e9) -- Fuerza infinita para vencer gravedad
        bv.Velocity = Vector3.zero
        
        bg = Instance.new("BodyGyro", root)
        bg.MaxTorque = Vector3.new(9e9, 9e9, 9e9)
        bg.P = 50000 
        
        hum.PlatformStand = true -- Desactiva la f√≠sica de caminar para poder volar
        flyConn = RunService.Heartbeat:Connect(flightStep)
    else
        hud:Notify("Fly: DESACTIVADO üõë")
        if flyConn then flyConn:Disconnect() flyConn = nil end
        if bv then bv:Destroy() bv = nil end
        if bg then bg:Destroy() bg = nil end
        if hum then hum.PlatformStand = false end
        state.currentVel = Vector3.zero
    end
end)

fMov:AddSlider("VELOCIDAD VUELO", 10, 300, 70, function(v)
    state.flySpeed = v
end)

fMov:AddButton("NOCLIP (ATRAVESAR)", function()
    state.noclip = not state.noclip
    hud:Notify(state.noclip and "Noclip: ACTIVADO üëª" or "Noclip: DESACTIVADO üß±")
    local nc; nc = RunService.Stepped:Connect(function()
        if not state.noclip then nc:Disconnect() return end
        if player.Character then
            for _, v in pairs(player.Character:GetDescendants()) do
                if v:IsA("BasePart") then v.CanCollide = false end
            end
        end
    end)
end)

fMov:AddSlider("VELOCIDAD CAMINAR", 16, 500, 16, function(v)
    if player.Character and player.Character:FindFirstChild("Humanoid") then 
        player.Character.Humanoid.WalkSpeed = v 
    end
end)

fMov:AddSlider("FUERZA SALTO", 50, 600, 50, function(v)
    if player.Character and player.Character:FindFirstChild("Humanoid") then 
        player.Character.Humanoid.JumpPower = v
        player.Character.Humanoid.UseJumpPower = true
    end
end)
