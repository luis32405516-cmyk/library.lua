local RainbowUI = loadstring(game:HttpGet("https://raw.githubusercontent.com/luis32405516-cmyk/library.lua/refs/heads/main/Prueba2?v=" .. tick()))()
local hud = RainbowUI:CreateWindow(240, 520)

-- [ VARIABLES LOCALES IMPORTANTES DEL ORIGINAL ]
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local player = Players.LocalPlayer
local camera = workspace.CurrentCamera
local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")
local root = character:WaitForChild("HumanoidRootPart")

-- [ VARIABLES DE ESTADO DEL ORIGINAL ]
local flying = false
local bv, bg, conn
local currentVel = Vector3.zero
local easing = 6
local flySpeed = 70 -- Vinculado al Slider

-- [ SISTEMA DE REFRESH ORIGINAL ]
local function refreshCharacter(newChar)
    character = newChar
    humanoid = newChar:WaitForChild("Humanoid")
    root = newChar:WaitForChild("HumanoidRootPart")
    if flying then -- Si morimos volando, limpiamos
        flying = false
        if conn then conn:Disconnect() conn=nil end
        if bv then bv:Destroy() bv=nil end
        if bg then bg:Destroy() bg=nil end
    end
end
player.CharacterAdded:Connect(refreshCharacter)

-- [ FUNCIONES DE FUERZAS ORIGINALES ]
local function setupForces()
    bv = Instance.new("BodyVelocity")
    bv.MaxForce = Vector3.new(1e5,1e5,1e5)
    bv.Velocity = Vector3.zero
    bv.Parent = root

    bg = Instance.new("BodyGyro")
    bg.MaxTorque = Vector3.new(1e5,1e5,1e5)
    bg.P = 9e4
    bg.Parent = root
end

local function cleanup()
    if bv then bv:Destroy() bv=nil end
    if bg then bg:Destroy() bg=nil end
end

-- [ LGICA DE VUELO NTEGRA (Mobile + PC) ]
local function flight(dt)
    if not flying then return end

    local dir = Vector3.zero
    local cam = camera.CFrame
    local moveVector = Vector3.zero

    -- L贸gica PC (Original)
    if UserInputService.KeyboardEnabled then
        if UserInputService:IsKeyDown(Enum.KeyCode.W) then dir += cam.LookVector end
        if UserInputService:IsKeyDown(Enum.KeyCode.S) then dir -= cam.LookVector end
        if UserInputService:IsKeyDown(Enum.KeyCode.A) then dir -= cam.RightVector end
        if UserInputService:IsKeyDown(Enum.KeyCode.D) then dir += cam.RightVector end
        if UserInputService:IsKeyDown(Enum.KeyCode.Space) then dir += Vector3.yAxis end
        if UserInputService:IsKeyDown(Enum.KeyCode.LeftControl) then dir -= Vector3.yAxis end
    end

    -- L贸gica Mobile (Original)
    if UserInputService.TouchEnabled and humanoid.MoveDirection.Magnitude > 0 then
        moveVector = humanoid.MoveDirection
    end

    local total = dir + moveVector
    if total.Magnitude > 0 then 
        total = total.Unit * flySpeed 
    end

    -- El suavizado exacto del script original
    currentVel = currentVel:Lerp(total, math.clamp(easing * dt, 0, 1))
    if bv then bv.Velocity = currentVel end
    if bg then 
        bg.CFrame = CFrame.new(Vector3.zero, currentVel.Magnitude > 0 and currentVel.Unit or cam.LookVector) 
    end
end

-- [ INTEGRACIN CON TU HUD ]
local fMov = hud:AddFolder("AJUSTES PERSONAJE 锔")

fMov:AddButton("VOLAR (FLY V3)", function()
    if flying then
        -- STOP FLY (L贸gica original)
        flying = false
        if conn then conn:Disconnect() conn = nil end
        humanoid.PlatformStand = false
        currentVel = Vector3.zero
        cleanup()
        hud:Notify("Fly: DESACTIVADO ")
    else
        -- START FLY (L贸gica original)
        if not root then return end
        flying = true
        setupForces()
        humanoid.PlatformStand = true
        conn = RunService.Heartbeat:Connect(flight)
        hud:Notify("Fly: ACTIVADO ")
    end
end)

fMov:AddSlider("VELOCIDAD VUELO", 10, 300, 70, function(v)
    flySpeed = v
end)

fMov:AddButton("NOCLIP (ATRAVESAR)", function()
    _G.noclip = not _G.noclip
    hud:Notify(_G.noclip and "Noclip: ON " or "Noclip: OFF П")
    RunService.Stepped:Connect(function()
        if _G.noclip and player.Character then
            for _, v in pairs(player.Character:GetDescendants()) do
                if v:IsA("BasePart") then v.CanCollide = false end
            end
        end
    end)
end)

fMov:AddSlider("VELOCIDAD CAMINAR", 16, 500, 16, function(v)
    if humanoid then humanoid.WalkSpeed = v end
end)

fMov:AddSlider("FUERZA SALTO", 50, 600, 50, function(v)
    if humanoid then 
        humanoid.JumpPower = v
        humanoid.UseJumpPower = true 
    end
end)
