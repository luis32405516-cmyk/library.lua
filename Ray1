-- [[ LUIS UNV - SCRIPT DEFINITIVO ACTUALIZADO ]]

local Library = loadstring(game:HttpGet("https://raw.githubusercontent.com/luis32405516-cmyk/library.lua/refs/heads/main/Ray"))()
local Window = Library:CreateWindow()

local Players = game:GetService("Players")
local LP = Players.LocalPlayer
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

-- [[ VARIABLES DE ESTADO ]]
local FLYING = false
local iyflyspeed = 1
local noclipActive = false
local InfJumpEnabled = false
local WalkSpeedValue = 16
local ESP_ENABLED = false
local FLING_ENABLED = false

-- [[ FUNCIONES DE APOYO ]]
local function getRoot(char)
    return char:FindFirstChild('HumanoidRootPart') or char:FindFirstChild('Torso') or char:FindFirstChild('UpperTorso')
end

-- [[ L√ìGICA FLY MOBILE (TU C√ìDIGO) ]]
local function unmobilefly()
    FLYING = false
    local root = getRoot(LP.Character)
    if root:FindFirstChild("IY_Velocity") then root["IY_Velocity"]:Destroy() end
    if root:FindFirstChild("IY_Gyro") then root["IY_Gyro"]:Destroy() end
    if LP.Character:FindFirstChildWhichIsA("Humanoid") then
        LP.Character:FindFirstChildWhichIsA("Humanoid").PlatformStand = false
    end
end

local function mobilefly()
    unmobilefly()
    FLYING = true
    local char = LP.Character
    local root = getRoot(char)
    local camera = workspace.CurrentCamera
    local controlModule = require(LP.PlayerScripts:WaitForChild("PlayerModule"):WaitForChild("ControlModule"))
    
    local bv = Instance.new("BodyVelocity", root)
    bv.Name = "IY_Velocity"
    bv.MaxForce = Vector3.new(9e9, 9e9, 9e9)
    bv.Velocity = Vector3.new(0, 0, 0)

    local bg = Instance.new("BodyGyro", root)
    bg.Name = "IY_Gyro"
    bg.MaxTorque = Vector3.new(9e9, 9e9, 9e9)
    bg.P = 1000
    bg.D = 50

    task.spawn(function()
        while FLYING do
            RunService.RenderStepped:Wait()
            if char and char.Parent and root:FindFirstChild("IY_Velocity") then
                char:FindFirstChildWhichIsA("Humanoid").PlatformStand = true
                root["IY_Gyro"].CFrame = camera.CFrame
                local direction = controlModule:GetMoveVector()
                local flyVelocity = Vector3.new(0,0,0)
                if direction.X ~= 0 then flyVelocity = flyVelocity + camera.CFrame.RightVector * (direction.X * (iyflyspeed * 50)) end
                if direction.Z ~= 0 then flyVelocity = flyVelocity - camera.CFrame.LookVector * (direction.Z * (iyflyspeed * 50)) end
                root["IY_Velocity"].Velocity = flyVelocity
            end
        end
    end)
end

---------------------------------------------------------
-- [ APARTADO: MOVIMIENTO ]
---------------------------------------------------------
local TabMov = Window:CreateTab("‚ö° MOVIMIENTO")

TabMov:CreateSlider("Velocidad", function(v)
    WalkSpeedValue = v
    if LP.Character and LP.Character:FindFirstChildOfClass("Humanoid") then
        LP.Character:FindFirstChildOfClass("Humanoid").WalkSpeed = v
    end
end)

TabMov:CreateSwitch("Fly Mobile (IY)", function(estado)
    if estado then mobilefly() else unmobilefly() end
end)

TabMov:CreateSlider("Fly Speed", function(v)
    iyflyspeed = v
end)

TabMov:CreateSwitch("Noclip üëª", function(estado)
    noclipActive = estado
    if noclipActive then
        _G.Noc = RunService.Stepped:Connect(function()
            if LP.Character then
                for _, v in pairs(LP.Character:GetDescendants()) do 
                    if v:IsA("BasePart") then v.CanCollide = false end 
                end
            end
        end)
    else
        if _G.Noc then _G.Noc:Disconnect() end
    end
end)

TabMov:CreateSwitch("Infinite Jump ü¶ò", function(estado)
    InfJumpEnabled = estado
end)

TabMov:CreateSwitch("Walk Fling üåÄ", function(estado)
    FLING_ENABLED = estado
    task.spawn(function()
        while FLING_ENABLED do
            RunService.Heartbeat:Wait()
            local root = getRoot(LP.Character)
            if root then
                local oldVel = root.Velocity
                root.Velocity = oldVel * 10000 + Vector3.new(0, 10000, 0)
                RunService.RenderStepped:Wait()
                if root then root.Velocity = oldVel end
            end
        end
    end)
end)

---------------------------------------------------------
-- [ APARTADO: VISUALES ]
---------------------------------------------------------
local TabVis = Window:CreateTab("üëÅÔ∏è VISUALES")

TabVis:CreateSwitch("ESP Rainbow üåà", function(estado)
    ESP_ENABLED = estado
    if ESP_ENABLED then
        task.spawn(function()
            while ESP_ENABLED do
                local color = Color3.fromHSV((tick() * 0.5) % 1, 1, 1)
                for _, player in pairs(Players:GetPlayers()) do
                    if player ~= LP and player.Character then
                        local hl = player.Character:FindFirstChild("IY_ESP") or Instance.new("Highlight", player.Character)
                        hl.Name = "IY_ESP"
                        hl.FillColor = color
                        hl.OutlineColor = Color3.new(1, 1, 1)
                        hl.FillTransparency = 0.5
                    end
                end
                task.wait()
            end
        end)
    else
        for _, player in pairs(Players:GetPlayers()) do
            if player.Character and player.Character:FindFirstChild("IY_ESP") then 
                player.Character.IY_ESP:Destroy() 
            end
        end
    end
end)

---------------------------------------------------------
-- [ EVENTOS GLOBALES ]
---------------------------------------------------------
UserInputService.JumpRequest:Connect(function()
    if InfJumpEnabled then
        local hum = LP.Character and LP.Character:FindFirstChildOfClass("Humanoid")
        if hum then hum:ChangeState("Jumping") end
    end
end)

LP.CharacterAdded:Connect(function(char)
    char:WaitForChild("Humanoid").WalkSpeed = WalkSpeedValue
end)
