local RainbowUI = {}
RainbowUI.__index = RainbowUI

local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local function rainbowColor(speed, sat, val)
    return Color3.fromHSV((tick() * speed) % 1, sat or 1, val or 1)
end

function RainbowUI:CreateWindow(width, height)
    local api = setmetatable({_folders = {}}, RainbowUI)
    width, height = width or 230, height or 120

    local sg = Instance.new("ScreenGui", game:GetService("Players").LocalPlayer.PlayerGui)
    sg.Name = "RainbowUI"
    sg.ResetOnSpawn = false
    api._sg = sg

    local frame = Instance.new("Frame", sg)
    frame.Name = "MainFrame"
    frame.Size = UDim2.fromOffset(width, 26)
    frame.Position = UDim2.fromOffset(160, 180)
    frame.BackgroundColor3 = Color3.fromRGB(12, 13, 21)
    frame.BorderSizePixel = 0
    api._frame = frame
    
    local borders = {}
    for _, side in ipairs({"Top", "Bottom", "Left", "Right"}) do
        local f = Instance.new("Frame", frame)
        f.BorderSizePixel = 0
        f.ZIndex = 3
        if side == "Top" then f.Size, f.Position = UDim2.new(1, 0, 0, 2), UDim2.new(0, 0, 0, -2)
        elseif side == "Bottom" then f.Size, f.Position = UDim2.new(1, 0, 0, 2), UDim2.new(0, 0, 1, 0)
        elseif side == "Left" then f.Size, f.Position = UDim2.new(0, 2, 1, 0), UDim2.new(0, -2, 0, 0)
        elseif side == "Right" then f.Size, f.Position = UDim2.new(0, 2, 1, 0), UDim2.new(1, 0, 0, 0) end
        table.insert(borders, f)
    end

    local bar = Instance.new("Frame", frame)
    bar.Size = UDim2.new(1, 0, 0, 26)
    bar.BackgroundColor3 = Color3.fromRGB(20, 20, 32)
    bar.BorderSizePixel = 0
    bar.ZIndex = 2

    local title = Instance.new("TextLabel", bar)
    title.Size = UDim2.new(1, -60, 1, 0)
    title.Position = UDim2.fromOffset(10, 0)
    title.Text = "SCRIPTðŸ˜ˆLUIS"
    title.Font = Enum.Font.GothamBold
    title.TextColor3 = Color3.new(1, 1, 1)
    title.TextSize = 16
    title.BackgroundTransparency = 1
    title.TextXAlignment = Enum.TextXAlignment.Left
    title.ZIndex = 3

    local scroll = Instance.new("ScrollingFrame", frame)
    scroll.Size = UDim2.new(1, -10, 1, -34)
    scroll.Position = UDim2.fromOffset(5, 30)
    scroll.BackgroundTransparency = 1
    scroll.ScrollBarThickness = 3
    scroll.Visible = false
    scroll.AutomaticCanvasSize = Enum.AutomaticSize.Y
    scroll.CanvasSize = UDim2.new(0,0,0,0)
    api._scroll = scroll

    local list = Instance.new("UIListLayout", scroll)
    list.Padding = UDim.new(0, 5)

    local collapseBtn = Instance.new("TextButton", bar)
    collapseBtn.Text = "â€”"
    collapseBtn.Size = UDim2.fromOffset(25, 25)
    collapseBtn.Position = UDim2.new(1, -30, 0, 0)
    collapseBtn.BackgroundTransparency = 1
    collapseBtn.TextColor3 = Color3.new(1, 0, 0)
    collapseBtn.ZIndex = 4

    collapseBtn.MouseButton1Click:Connect(function()
        scroll.Visible = not scroll.Visible
        frame.Size = scroll.Visible and UDim2.fromOffset(width, height) or UDim2.fromOffset(width, 26)
        collapseBtn.Text = scroll.Visible and "v" or "â€”"
    end)

    -- Rainbow Effect Loop
    RunService.RenderStepped:Connect(function()
        for i, b in ipairs(borders) do b.BackgroundColor3 = rainbowColor(0.4 + (i*0.05)) end
    end)

    -- Draggable Function
    local dragging, dragStart, startPos
    bar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true dragStart = input.Position startPos = frame.Position
        end
    end)
    UserInputService.InputChanged:Connect(function(input)
        if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
            local delta = input.Position - dragStart
            frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end)
    UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then dragging = false end
    end)

    return api
end

function RainbowUI:AddFolder(name)
    local folderApi = {_open = false}
    local btn = Instance.new("TextButton", self._scroll)
    btn.Text = "[+] " .. name
    btn.Size = UDim2.new(1, 0, 0, 25)
    btn.BackgroundColor3 = Color3.fromRGB(30, 30, 45)
    btn.TextColor3 = Color3.new(1, 1, 1)
    btn.Font = Enum.Font.GothamBold

    local container = Instance.new("Frame", self._scroll)
    container.Size = UDim2.new(1, 0, 0, 0)
    container.BackgroundTransparency = 1
    container.Visible = false
    container.AutomaticSize = Enum.AutomaticSize.Y
    Instance.new("UIListLayout", container).Padding = UDim.new(0, 3)

    btn.MouseButton1Click:Connect(function()
        folderApi._open = not folderApi._open
        container.Visible = folderApi._open
        btn.Text = (folderApi._open and "[-] " or "[+] ") .. name
    end)

    function folderApi:AddButton(text, cb)
        local b = Instance.new("TextButton", container)
        b.Text = text
        b.Size = UDim2.new(1, 0, 0, 22)
        b.BackgroundColor3 = Color3.fromRGB(40, 40, 60)
        b.TextColor3 = Color3.new(0.9, 0.9, 1)
        b.Font = Enum.Font.GothamSemibold
        b.MouseButton1Click:Connect(cb)
    end

    function folderApi:AddRowButtons(b1d, b2d)
        local row = Instance.new("Frame", container)
        row.Size = UDim2.new(1, 0, 0, 25)
        row.BackgroundTransparency = 1
        local function createB(d, pos)
            local b = Instance.new("TextButton", row)
            b.Size = UDim2.new(0.5, -2, 1, 0)
            b.Position = pos
            b.Text = d.text
            b.BackgroundColor3 = Color3.fromRGB(40, 40, 60)
            b.TextColor3 = Color3.new(1, 1, 1)
            b.MouseButton1Click:Connect(d.callback)
        end
        createB(b1d, UDim2.new(0, 0, 0, 0))
        createB(b2d, UDim2.new(0.5, 2, 0, 0))
    end
    return folderApi
end

function RainbowUI:AddButton(text, cb)
    local b = Instance.new("TextButton", self._scroll)
    b.Text = text
    b.Size = UDim2.new(1, 0, 0, 25)
    b.BackgroundColor3 = Color3.fromRGB(30, 30, 45)
    b.TextColor3 = Color3.new(1, 1, 1)
    b.Font = Enum.Font.GothamBold
    b.MouseButton1Click:Connect(cb)
end

function RainbowUI:Notify(text, duration)
    task.spawn(function()
        local n = Instance.new("TextLabel", self._sg)
        n.Text = text
        n.Size = UDim2.new(0, 250, 0, 30)
        n.Position = UDim2.new(0.5, -125, 0, 50)
        n.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
        n.TextColor3 = Color3.new(1, 1, 1)
        n.Font = Enum.Font.GothamBold
        n.TextSize = 14
        local b = Instance.new("Frame", n)
        b.Size = UDim2.new(1, 0, 0, 2)
        b.Position = UDim2.new(0, 0, 1, 0)
        b.BackgroundColor3 = Color3.new(1, 0, 0)
        task.wait(duration or 2)
        n:Destroy()
    end)
end

return RainbowUI
